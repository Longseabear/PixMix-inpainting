<!-- saved from url=(0014)about:internet -->
<pre class="code">
<span class="srcline"><span class="lineno"><a href="1,185" id="srcline185">185</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,186" id="srcline186">186</a></span><span class="line"><span class="comment">% fij may change due to propagation or random search.</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,187" id="srcline187">187</a></span><span class="line"><span class="keyword">function</span> <span class="var type1" id="S81T5U1066">apc</span> = calcAppearanceCost(<span class="var type1" id="S82T5U1069">i</span>,<span class="var type1" id="S83T5U1070">j</span>, <span class="var type1" id="S84T4U1071">fij</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="1,188" id="srcline188">188</a></span><span class="line"><span class="keyword">global</span> <span class="var type0" id="S85T0U1073">f</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,189" id="srcline189">189</a></span><span class="line"><span class="keyword">global</span> <span class="var type0" id="S86T0U1075">R</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,190" id="srcline190">190</a></span><span class="line"><span class="keyword">global</span> <span class="var type0" id="S87T0U1077">C</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,191" id="srcline191">191</a></span><span class="line"><span class="keyword">global</span> <span class="var type0" id="S88T0U1079">im</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,192" id="srcline192">192</a></span><span class="line"><span class="mxinfo " id="T5:U5"><span class="var type1" id="S81T5U1082">apc</span> = <span class="mxinfo " id="T5:U7">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,193" id="srcline193">193</a></span><span class="line"><span class="mxinfo " id="T5:U8"><span class="var type1" id="S89T5U1086">w</span> = <span class="mxinfo " id="T5:U10"><span class="mxinfo " id="T5:U11">1</span>/<span class="mxinfo " id="T5:U12">25</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,194" id="srcline194">194</a></span><span class="line"><span class="keyword">for</span> <span class="var type1" id="S90T5U1092">r</span> = <span class="mxinfo " id="T31:U14">max(<span class="mxinfo " id="T5:U15"><span class="var type1" id="S82T5U1097">i</span>-<span class="mxinfo " id="T5:U17">2</span></span>,<span class="mxinfo " id="T5:U18">1</span>):min(<span class="mxinfo " id="T5:U19"><span class="var type1" id="S82T5U1103">i</span>+<span class="mxinfo " id="T5:U21">2</span></span>,<span class="var type1" id="S86T5U1105">R</span>)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,195" id="srcline195">195</a></span><span class="line">    <span class="keyword">for</span> <span class="var type1" id="S93T5U1108">c</span> = <span class="mxinfo " id="T31:U24">max(<span class="mxinfo " id="T5:U25"><span class="var type1" id="S83T5U1113">j</span>-<span class="mxinfo " id="T5:U27">2</span></span>,<span class="mxinfo " id="T5:U28">1</span>):min(<span class="mxinfo " id="T5:U29"><span class="var type1" id="S83T5U1119">j</span>+<span class="mxinfo " id="T5:U31">2</span></span>,<span class="var type1" id="S87T5U1121">C</span>)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,196" id="srcline196">196</a></span><span class="line">        <span class="comment">% f(p) = fij, f(p+v) = f(r,c,:), v = [r-i, c-j], f(p)+v = fij+v</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,197" id="srcline197">197</a></span><span class="line">        <span class="mxinfo " id="T6:U33"><span class="var type1" id="S94T6U1124">v</span> = <span class="mxinfo " id="T6:U35"><span class="mxinfo " id="T6:U36">[<span class="var type1" id="S90T5U1128">r</span>,<span class="var type1" id="S93T5U1129">c</span>]</span> - <span class="mxinfo " id="T6:U39">[<span class="var type1" id="S82T5U1132">i</span>,<span class="var type1" id="S83T5U1133">j</span>]</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,198" id="srcline198">198</a></span><span class="line">        <span class="mxinfo " id="T30:U42"><span class="var type1" id="S95T30U1136">i1</span> = <span class="mxinfo " id="T30:U44"><span class="var type1" id="S88T2U1138">im</span>(<span class="var type1" id="S90T5U1139">r</span>,<span class="var type1" id="S93T5U1140">c</span>,<span class="mxinfo " id="T33:U48">:</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,199" id="srcline199">199</a></span><span class="line">        <span class="keyword">if</span> isValid([<span class="mxinfo " id="T5:U49"><span class="var type1" id="S84T4U1150">fij</span>(1)+<span class="mxinfo " id="T5:U51"><span class="var type1" id="S94T6U1153">v</span>(<span class="mxinfo " id="T33:U53">1</span>)</span></span>, <span class="var type1" id="S84T4U1157">fij</span>(<span class="mxinfo " id="T5:U55"><span class="message error" id="M22F92C">2</span></span>)+<span class="var type0" id="S94T0U1160">v</span>(2)])</span></span>
<span class="srcline"><span class="lineno"><a href="1,200" id="srcline200">200</a></span><span class="line">            <span class="var type0" id="S97T0U1164">i2</span> = <span class="var type1" id="S88T2U1166">im</span>(<span class="mxinfo " id="T5:U57"><span class="var type1" id="S84T4U1169">fij</span>(1)+<span class="mxinfo " id="T5:U59"><span class="var type1" id="S94T6U1172">v</span>(<span class="mxinfo " id="T33:U61">1</span>)</span></span>, <span class="var type1" id="S84T4U1176">fij</span>(<span class="mxinfo " id="T5:U63"><span class="message error" id="M23F92C">2</span></span>)+<span class="var type0" id="S94T0U1179">v</span>(2), :);</span></span>
<span class="srcline"><span class="lineno"><a href="1,201" id="srcline201">201</a></span><span class="line">        <span class="keyword">else</span> </span></span>
<span class="srcline"><span class="lineno"><a href="1,202" id="srcline202">202</a></span><span class="line">            <span class="mxinfo " id="T5:U64"><span class="var type1" id="S97T5U1185">i2</span> = <span class="mxinfo " id="T5:U66">zeros(size(<span class="var type1" id="S95T30U1190">i1</span>))</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,203" id="srcline203">203</a></span><span class="line">        <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,204" id="srcline204">204</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="1,205" id="srcline205">205</a></span><span class="line">        <span class="mxinfo " id="T5:U68"><span class="var type1" id="S81T5U1193"><span class="message error" id="M24F92C">apc</span></span></span> = <span class="mxinfo " id="T30:U69"><span class="var type1" id="S81T5U1195">apc</span> + <span class="mxinfo " id="T30:U71"><span class="mxinfo " id="T30:U72">norm(<span class="mxinfo " id="T30:U73">squeeze(<span class="mxinfo " id="T30:U74"><span class="var type1" id="S95T30U1202">i1</span>-<span class="var type1" id="S97T5U1203">i2</span></span>)</span>)</span>^2</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,206" id="srcline206">206</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,207" id="srcline207">207</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,208" id="srcline208">208</a></span><span class="line"><span class="mxinfo " id="T5:U77"><span class="var type1" id="S81T5U1207">apc</span> = <span class="mxinfo " id="T5:U79"><span class="var type1" id="S81T5U1209">apc</span>*<span class="var type1" id="S89T5U1210">w</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,209" id="srcline209">209</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,210" id="srcline210">210</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,211" id="srcline211">211</a></span><span class="line"></span></span>
</pre>
