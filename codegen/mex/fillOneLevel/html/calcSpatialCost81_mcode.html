<!-- saved from url=(0014)about:internet -->
<pre class="code">
<span class="srcline"><span class="lineno"><a href="1,163" id="srcline163">163</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,164" id="srcline164">164</a></span><span class="line"><span class="comment">% fij may change due to propagation or random search.</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,165" id="srcline165">165</a></span><span class="line"><span class="keyword">function</span> <span class="var type1" id="S62T5U955">spc</span> = calcSpatialCost(<span class="var type1" id="S63T5U958">i</span>,<span class="var type1" id="S64T5U959">j</span>, <span class="var type1" id="S65T4U960">fij</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="1,166" id="srcline166">166</a></span><span class="line"><span class="keyword">global</span> <span class="var type0" id="S66T0U962">f</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,167" id="srcline167">167</a></span><span class="line"><span class="keyword">global</span> <span class="var type0" id="S67T0U964">R</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,168" id="srcline168">168</a></span><span class="line"><span class="keyword">global</span> <span class="var type0" id="S68T0U966">C</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,169" id="srcline169">169</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,170" id="srcline170">170</a></span><span class="line"><span class="mxinfo " id="T5:U5"><span class="var type1" id="S62T5U969">spc</span> = <span class="mxinfo " id="T5:U7">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,171" id="srcline171">171</a></span><span class="line"><span class="mxinfo " id="T5:U8"><span class="var type1" id="S69T5U973">w</span> = <span class="mxinfo " id="T5:U10"><span class="mxinfo " id="T5:U11">1</span>/<span class="mxinfo " id="T5:U12">8</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,172" id="srcline172">172</a></span><span class="line"><span class="mxinfo " id="T5:U13"><span class="var type1" id="S70T5U979">tao</span> = <span class="mxinfo " id="T5:U15">200</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,173" id="srcline173">173</a></span><span class="line"><span class="keyword">for</span> <span class="var type1" id="S71T5U983">r</span> = <span class="mxinfo " id="T31:U17">max(<span class="mxinfo " id="T5:U18"><span class="var type1" id="S63T5U988">i</span>-<span class="mxinfo " id="T5:U20">1</span></span>,<span class="mxinfo " id="T5:U21">1</span>):min(<span class="mxinfo " id="T5:U22"><span class="var type1" id="S63T5U994">i</span>+<span class="mxinfo " id="T5:U24">1</span></span>,<span class="var type1" id="S67T5U996">R</span>)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,174" id="srcline174">174</a></span><span class="line">    <span class="keyword">for</span> <span class="var type1" id="S74T5U999">c</span> = <span class="mxinfo " id="T31:U27">max(<span class="mxinfo " id="T5:U28"><span class="var type1" id="S64T5U1004">j</span>-<span class="mxinfo " id="T5:U30">1</span></span>,<span class="mxinfo " id="T5:U31">1</span>):min(<span class="mxinfo " id="T5:U32"><span class="var type1" id="S64T5U1010">j</span>+<span class="mxinfo " id="T5:U34">1</span></span>,<span class="var type1" id="S68T5U1012">C</span>)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,175" id="srcline175">175</a></span><span class="line">        <span class="comment">% f(p) = fij, f(p+v) = f(r,c,:), v = [r-i], c-j], f(p)+v = fij+v</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,176" id="srcline176">176</a></span><span class="line">        <span class="mxinfo " id="T6:U36"><span class="var type1" id="S75T6U1015">v</span> = <span class="mxinfo " id="T6:U38"><span class="mxinfo " id="T6:U39">[<span class="var type1" id="S71T5U1019">r</span>,<span class="var type1" id="S74T5U1020">c</span>]</span> - <span class="mxinfo " id="T6:U42">[<span class="var type1" id="S63T5U1023">i</span>,<span class="var type1" id="S64T5U1024">j</span>]</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,177" id="srcline177">177</a></span><span class="line">        <span class="mxinfo " id="T4:U45"><span class="var type1" id="S76T4U1027">fv</span> = <span class="mxinfo " id="T4:U47">squeeze(<span class="mxinfo " id="T4:U48"><span class="var type1" id="S66T1U1031">f</span>(<span class="var type1" id="S71T5U1032">r</span>, <span class="var type1" id="S74T5U1033">c</span>, <span class="mxinfo " id="T33:U52">:</span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,178" id="srcline178">178</a></span><span class="line">        <span class="var type0" id="S78T0U1037">diff</span> = <span class="var type1" id="S76T4U1039">fv</span> - (<span class="message error" id="M20F81C"><span class="var type1" id="S65T4U1042">fij</span>+<span class="mxinfo " id="T42:U55"><span class="var type1" id="S75T6U1044">v</span>'</span></span>);</span></span>
<span class="srcline"><span class="lineno"><a href="1,179" id="srcline179">179</a></span><span class="line">        <span class="var type0" id="S62T0U1047">spc</span> = <span class="var type1" id="S62T5U1049">spc</span> + min(norm(<span class="var type0" id="S78T0U1055"><span class="message error" id="M21F81C">diff</span></span>)^2, <span class="var type0" id="S70T0U1057">tao</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="1,180" id="srcline180">180</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,181" id="srcline181">181</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,182" id="srcline182">182</a></span><span class="line"><span class="mxinfo " id="T5:U58"><span class="var type1" id="S62T5U1060">spc</span> = <span class="mxinfo " id="T5:U60"><span class="var type1" id="S62T5U1062">spc</span>*<span class="var type1" id="S69T5U1063">w</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,183" id="srcline183">183</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,184" id="srcline184">184</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,185" id="srcline185">185</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,186" id="srcline186">186</a></span><span class="line"><span class="comment">% fij may change due to propagation or random search.</span></span></span>
</pre>
